<script>
(function(){

var track = document.getElementById("track");
var trail = document.getElementById("trail");
var text  = document.getElementById("text");
var shuttle = document.getElementById("shuttle");

var lines = [
  "WELCOME TO TAPS SHUTTLES",
  "MATAMATA-PIAKO BASED SERVICE — DOOR TO DOOR DIRECT",
  "HAMILTON AIRPORT → TE AROHA FROM $110",
  "HAMILTON AIRPORT → MORRINSVILLE FROM $110",
  "HAMILTON AIRPORT → MATAMATA FROM $120",
  "TE AROHA → AUCKLAND AIRPORT FROM $230",
  "SEE OUR SUPER DEALS FOR MORE LOCATIONS BELOW!! ✈️"
];

var legMs   = 12000;
var pauseMs = 350;
var padL    = 42;
var padR    = 42;
var gap     = 14;

var dir = 1;
var idx = 0;
var start = performance.now();
var waitUntil = 0;
var legOrigin = null;

text.textContent = lines[0];

function ease(t){ return 0.5 - 0.5*Math.cos(Math.PI*t); }

function setLine(i){
  idx = (i + lines.length) % lines.length;
  text.textContent = lines[idx];
  trail.style.width = "0px";
}

function resetOrigin(tr){
  var sr = shuttle.getBoundingClientRect();
  if(dir === 1){
    legOrigin = (sr.left - tr.left) - gap;
  } else {
    legOrigin = (sr.right - tr.left) + gap;
  }
}

function loop(now){

  if(now < waitUntil){
    requestAnimationFrame(loop);
    return;
  }

  var trackW = track.clientWidth;
  var sW = shuttle.getBoundingClientRect().width;

  var minX = padL;
  var maxX = Math.max(minX, trackW - sW - padR);

  var t = (now - start)/legMs;
  if(t > 1) t = 1;

  var p = ease(t);
  var travelT = (dir === 1) ? p : (1 - p);
  var x = minX + (maxX - minX) * travelT;

  shuttle.style.left = x + "px";

  var tr = track.getBoundingClientRect();
  var sr = shuttle.getBoundingClientRect();

  if(legOrigin === null){
    resetOrigin(tr);
    trail.style.width = "0px";
  }

  if(dir === 1){
    var endX = (sr.left - tr.left) - gap;
    var w = Math.max(0, endX - legOrigin);
    trail.style.left = legOrigin + "px";
    trail.style.width = w + "px";
    trail.style.textAlign = "right";
  } else {
    var startX = (sr.right - tr.left) + gap;
    var w2 = Math.max(0, legOrigin - startX);
    trail.style.left = startX + "px";
    trail.style.width = w2 + "px";
    trail.style.textAlign = "left";
  }

  if(t >= 1){
    dir *= -1;
    start = now;
    waitUntil = now + pauseMs;
    setLine(idx + 1);
    legOrigin = null;
  }

  requestAnimationFrame(loop);
}

requestAnimationFrame(loop);

})();
</script>
