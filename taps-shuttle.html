<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">

<style>
  body{margin:0;background:transparent;}

  .track{
    position:relative;
    width:100%;
    height:120px;
    overflow:hidden;
  }

  .end{
    position:absolute;
    bottom:6px;
    font-size:28px;
    user-select:none;
    z-index:4;
  }
  .home{left:0;}
  .air{right:0;}

  .shuttle{
    position:absolute;
    bottom:2px;
    width:72px;
    z-index:3;
    will-change:left;
  }
  .hidden{display:none;}

  .trail{
    position:absolute;
    height:30px;
    overflow:hidden;
    z-index:2;
    pointer-events:none;
    box-sizing:border-box;
    padding:0 6px;
  }

  .trail span{
    display:block;
    white-space:nowrap;
    font-family:'Inter',sans-serif;
    font-size:14px;
    font-weight:300;
    letter-spacing:0.8px;
    text-transform:uppercase;

    color:black;
    -webkit-text-stroke:1.2px black;
    text-shadow:
      -1px -1px 0 #000,
       1px -1px 0 #000,
      -1px  1px 0 #000,
       1px  1px 0 #000;
  }
</style>
</head>
<body>

<div class="track" id="track">
  <div class="trail" id="trail"><span id="text"></span></div>

  <div class="end home">üè†</div>
  <div class="end air">‚úàÔ∏è</div>

  <!-- Right-facing shuttle -->
  <svg class="shuttle" id="shuttleR" viewBox="0 0 220 120" xmlns="http://www.w3.org/2000/svg" aria-label="Shuttle right">
    <rect x="20" y="35" width="150" height="45" rx="12" fill="#111"/>
    <rect x="155" y="45" width="35" height="35" rx="10" fill="#111"/>
    <rect x="30" y="67" width="135" height="6" rx="3" fill="#ffffff" opacity="0.85"/>
    <circle cx="60" cy="88" r="13" fill="#000"/><circle cx="60" cy="88" r="6" fill="#666"/>
    <circle cx="140" cy="88" r="13" fill="#000"/><circle cx="140" cy="88" r="6" fill="#666"/>
  </svg>

  <!-- Left-facing shuttle (mirrored inside SVG, NO CSS flip) -->
  <svg class="shuttle hidden" id="shuttleL" viewBox="0 0 220 120" xmlns="http://www.w3.org/2000/svg" aria-label="Shuttle left">
    <g transform="translate(220,0) scale(-1,1)">
      <rect x="20" y="35" width="150" height="45" rx="12" fill="#111"/>
      <rect x="155" y="45" width="35" height="35" rx="10" fill="#111"/>
      <rect x="30" y="67" width="135" height="6" rx="3" fill="#ffffff" opacity="0.85"/>
      <circle cx="60" cy="88" r="13" fill="#000"/><circle cx="60" cy="88" r="6" fill="#666"/>
      <circle cx="140" cy="88" r="13" fill="#000"/><circle cx="140" cy="88" r="6" fill="#666"/>
    </g>
  </svg>
</div>

<script>
(function(){
  var track = document.getElementById("track");
  var trail = document.getElementById("trail");
  var text  = document.getElementById("text");
  var R     = document.getElementById("shuttleR");
  var L     = document.getElementById("shuttleL");

  var lines = [
    "WELCOME TO TAPS SHUTTLES",
    "MATAMATA-PIAKO BASED SERVICE ‚Äî DOOR TO DOOR DIRECT",
    "HAMILTON AIRPORT ‚Üí TE AROHA FROM $110",
    "HAMILTON AIRPORT ‚Üí MORRINSVILLE FROM $110",
    "HAMILTON AIRPORT ‚Üí MATAMATA FROM $120",
    "TE AROHA ‚Üí AUCKLAND AIRPORT FROM $230",
    "SEE OUR SUPER DEALS FOR MORE LOCATIONS BELOW!! ‚úàÔ∏è"
  ];

  /* ===== TUNE ===== */
  var legMs   = 12000;  // bigger = slower shuttle
  var pauseMs = 350;
  var padL    = 42;
  var padR    = 42;

  var gap     = 14;     // space between shuttle and text
  var bodyY   = 0.60;   // vertical lock on shuttle body
  var yNudge  = 0;

  var capMax  = 900;    // cap trail length (big so it rarely caps)
  /* ============== */

  var dir = 1; // 1 right, -1 left
  var idx = 0;

  var start = performance.now();
  var waitUntil = 0;

  // Origin for the current leg (in track coords):
  // - moving right: origin is where trail STARTS (left edge)
  // - moving left : origin is where trail ENDS (right edge)
  var legOrigin = null;

  text.textContent = lines[0];

  function ease(t){ return 0.5 - 0.5*Math.cos(Math.PI*t); }

  function show(el){ el.classList.remove("hidden"); }
  function hide(el){ el.classList.add("hidden"); }

  function setLine(i){
    idx = (i + lines.length) % lines.length;
    text.textContent = lines[idx];
    trail.style.width = "0px";
  }

  function resetOrigin(active, tr){
    // measure shuttle after it‚Äôs positioned and the correct one is visible
    var sr = active.getBoundingClientRect();
    // use the ‚Äúback edge‚Äù where the trail touches (no overlap)
    if(dir === 1){
      // moving right: trail END is shuttle left - gap, so origin should be that same point at start
      legOrigin = (sr.left - tr.left) - gap;
    } else {
      // moving left: trail START is shuttle right + gap, so origin should be that point at start,
      // but because trail grows left->right (width increases to the left), we store the END point:
      legOrigin = (sr.right - tr.left) + gap;
    }
  }

  function loop(now){
    if(now < waitUntil){ requestAnimationFrame(loop); return; }

    var active = (dir === 1) ? R : L;
    var other  = (dir === 1) ? L : R;
    show(active); hide(other);

    var trackW = track.clientWidth;
    var sW = active.getBoundingClientRect().width || 72;

    var minX = padL;
    var maxX = Math.max(minX, trackW - sW - padR);

    var t = (now - start) / legMs;
    if(t > 1) t = 1;

    var p = ease(t);
    var travelT = (dir === 1) ? p : (1 - p);
    var x = minX + (maxX - minX) * travelT;

    // position both so swapping is seamless
    R.style.left = x + "px";
    L.style.left = x + "px";

    var tr = track.getBoundingClientRect();
    var sr = active.getBoundingClientRect();

    // vertical lock
    var centerY = (sr.top - tr.top) + (sr.height * bodyY) + yNudge;
    trail.style.top = Math.max(0, centerY - 15) + "px";

    // set legOrigin exactly once at the start of each leg
    if(legOrigin === null){
      resetOrigin(active, tr);
      // also reset width instantly so it starts ‚Äúattached‚Äù
      trail.style.width = "0px";
    }

    if(dir === 1){
      // moving right: trail end follows shuttle left - gap
      var endX = (sr.left - tr.left) - gap;

      // width grows based on actual pixel distance since leg start
      var w = Math.max(0, endX - legOrigin);
      if(w > capMax) w = capMax;

      // trail starts at legOrigin and expands rightwards
      trail.style.left = legOrigin + "px";
      trail.style.width = w + "px";
      trail.style.textAlign = "right";
    } else {
      // moving left: trail start follows shuttle right + gap
      var startX = (sr.right - tr.left) + gap;

      // width grows based on actual pixel distance since leg start (from right towards left)
      var w2 = Math.max(0, legOrigin - startX);
      if(w2 > capMax) w2 = capMax;

      // trail starts at startX and expands rightwards until legOrigin (end)
      trail.style.left = startX + "px";
      trail.style.width = w2 + "px";
      trail.style.textAlign = "left";
    }

    if(t >= 1){
      // turnaround
      dir *= -1;
      start = now;
      waitUntil = now + pauseMs;

      setLine(idx + 1);
      legOrigin = null; // ‚úÖ force new origin capture for the next leg
    }

    requestAnimationFrame(loop);
  }

  requestAnimationFrame(loop);
})();
</script>

</body>
</html>
